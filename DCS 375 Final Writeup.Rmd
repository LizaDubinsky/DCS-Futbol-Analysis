---
title: "DCS 375 Final Writeup"
author: "Dieter Villegas, Liza Dubinsky, Quinn Macauley, Jenniflore Beaubrun"
date: "4/20/2022"
output: html_document
---

```{r setup, include = FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


```{r load-libraries, include = FALSE}
library(dplyr)
library(igraph) 
#install.packages("magick")
library(magick)
```

## Final project for DCS 375 on Players in the 2018 World Cup Semi-Final and Final


### Introduction 

In this project, we used Statsbomb event data from the [Dato-Futbol/passing-networks GitHub repository](https://github.com/Dato-Futbol/passing-networks) to analyze the final and semi-final games in the 2018 World Cup. Motivated by scholarly articles on constructing and analyzing passing networks, we used network analysis to explore the following questions:

1. What players are central to the directed networks of the France-Croatia final and France-Belgium semi-final? What positions do they play?
2. How are the number of passes allocated across players on each team? 


### Background 

2. Sufficient background to make the significance of your question legible for non-expert readers:
Soccer background, motivation for question and why our question/hypotheses are significant (Dieter?)

### Methodology and Discussion 

In the following sections, we include our methodology for our analyses followed directly by our discussion of the relevant results and visualizations. 

#### Filtering the Data 

The original dataset included 227886 rows and 161 columns that covered the games of the 2018 World Cup. We decided to focus our analysis on the final and semi-final games of the 2018 World Cup, and filtered for variables concerning the teams, players, and type of play:

```{r clean-data, include = FALSE}

# read in the RDS
wc_rds <- readRDS("WC_events_clean.RDS")

# grab only the columns we're interested in for analysis
wc_maxtrix <- cbind(wc_rds$period,wc_rds$timestamp, wc_rds$duration,wc_rds$possession_team.name,wc_rds$type.name,wc_rds$player.name,wc_rds$team.name,wc_rds$pass.length,wc_rds$pass.recipient.name,wc_rds$pass.outcome.name,wc_rds$ball_receipt.outcome.name,wc_rds$match_id,wc_rds$location.x,wc_rds$location.y,wc_rds$pass.end_location.x,wc_rds$pass.end_location.y)

# turn into a dataframe
wc_df_official <- as.data.frame(wc_maxtrix)

# rename the columns for analysis
colnames(wc_df_official) <- c("period","timestamp","duration","possession_team.name","type.name","player.name","team.name","pass.length","pass.recipient.name","pass.outcome.name","ball_receipt.outcome.name","match_id","location.x","location.y","pass.end_location.x","pass.end_location.y")
```

The below code allowed us to isolate only the passing plays for our analyses, as well as create 2 datasets and write 2 .csv files for the final and semi-final games:

```{r filter-write-csv, warning = FALSE}
# grab only the passes
network_passes <- subset(wc_df_official, type.name == "Pass")

# create 2 data sets for 2 games we plan to analyze
france_croatia_final <- subset(network_passes, possession_team.name == c("France", "Croatia"))

france_belgium_semi <- subset(network_passes, team.name == c("France", "Belgium"))

# write 2 csv files for each of these games

write.csv(france_croatia_final, "france_croatia_final.csv", row.names = FALSE)

write.csv(france_belgium_semi, "france_belgium_semi.csv", row.names = FALSE)

```

Using these .csv files, we filtered the data further to remove any extraneous rows from other games, remove players who didn't play in either the final or semi-final, and isolate only the connected passes by removing any pass outcomes that were "Incomplete", "Out", or "Unknown". The below code is for the French team in the France-Croatia final:

```{r france-final-filter, warning= FALSE}

# clean the data frame to only include passes from france and croatia final
# reading in csv so that we dont have to re-run top part in case of a premature change to players
team_name_france_croatia_final <-  read.csv("france_croatia_final.csv")

team_name_france_croatia_final <- subset(team_name_france_croatia_final, team.name == c("France", "Croatia"))

france_only_final <- subset(team_name_france_croatia_final, team.name == "France")
france_only_final <- subset(france_only_final, player.name  != "Steve Mandanda")
france_only_final <- subset(france_only_final, pass.recipient.name  != "Steve Mandanda")

france_only_final <- subset(france_only_final, player.name != "Presnel Kimpembe")
france_only_final <- subset(france_only_final, pass.recipient.name != "Presnel Kimpembe")

france_only_final <- subset(france_only_final, player.name != "Thomas Lemar")
france_only_final <- subset(france_only_final, pass.recipient.name != "Thomas Lemar")
```

```{r, include = FALSE}
france_only_final <- subset(france_only_final, player.name != "Ousmane Dembélé")
france_only_final <- subset(france_only_final, pass.recipient.name != "Ousmane Dembélé")

france_only_final <- subset(france_only_final, player.name != "Benjamin Mendy")
france_only_final <- subset(france_only_final, pass.recipient.name != "Benjamin Mendy")

france_only_final <- subset(france_only_final, player.name != "Benjamin Mendy")
france_only_final <- subset(france_only_final, pass.recipient.name != "Benjamin Mendy")
	
france_only_final <- subset(france_only_final, player.name != "Florian Thauvin")
france_only_final <- subset(france_only_final, pass.recipient.name != "Florian Thauvin")

france_only_final <- subset(france_only_final, player.name != "Djibril Sidibé")
france_only_final <- subset(france_only_final, pass.recipient.name != "Djibril Sidibé")
```

```{r, warning = FALSE}
# construct dataset for connected passes only 
connected_pass_france_final <- subset(france_only_final, is.na(pass.outcome.name))

```

```{r croatia-network-object, include = FALSE}

croatia_only_final <- subset(team_name_france_croatia_final, team.name == "Croatia")
croatia_only_final <- subset(croatia_only_final, player.name  != "Lovre Kalinić")
croatia_only_final <- subset(croatia_only_final, pass.recipient.name  != "Lovre Kalinić")

croatia_only_final <- subset(croatia_only_final, player.name  != "Vedran Ćorluka")
croatia_only_final <- subset(croatia_only_final, pass.recipient.name  != "Vedran Ćorluka")

croatia_only_final <- subset(croatia_only_final, player.name  != "Tin Jedvaj")
croatia_only_final <- subset(croatia_only_final, pass.recipient.name  != "Tin Jedvaj")

croatia_only_final <- subset(croatia_only_final, player.name  != "Mateo Kovačić")
croatia_only_final <- subset(croatia_only_final, pass.recipient.name  != "Mateo Kovačić")

croatia_only_final <- subset(croatia_only_final, player.name  != "	Filip Bradarić")
croatia_only_final <- subset(croatia_only_final, pass.recipient.name  != "Filip Bradarić")

croatia_only_final <- subset(croatia_only_final, player.name  != "Duje Ćaleta-Car")
croatia_only_final <- subset(croatia_only_final, pass.recipient.name  != "Duje Ćaleta-Car")

croatia_only_final <- subset(croatia_only_final, player.name  != "Milan Badelj")
croatia_only_final <- subset(croatia_only_final, pass.recipient.name  != "Milan Badelj")

croatia_only_final <- subset(croatia_only_final, player.name  != "Josip Pivarić")
croatia_only_final <- subset(croatia_only_final, pass.recipient.name  != "Josip Pivarić")


# construct dataset for connected passes only 
connected_pass_croatia_final <- subset(croatia_only_final, is.na(pass.outcome.name))

# create an edgelist of passes to and from players
croatia_final <- cbind(connected_pass_croatia_final$player.name, connected_pass_croatia_final$pass.recipient.name)

# name these columns
colnames(croatia_final) <- c("from", "to")

# create a graph object for network analysis
croatia_final.g <- graph.edgelist(croatia_final, directed = TRUE) # makes a graph object
```

```{r semi-network-objects, include = FALSE}

# read in csv so that we don't have to re-run top part in case of a premature change to players.
france_belgium_semi <- read.csv("france_belgium_semi.csv")

# clean the data frame to only include passes from france and croatia final
team_name_france_belgium_semi <- subset(france_belgium_semi, team.name == c("France", "Belgium"))

france_only_semi <- subset(team_name_france_belgium_semi, team.name == "France")
france_only_semi <- subset(france_only_semi, player.name != "Steve Mandanda")
france_only_semi <- subset(france_only_semi, pass.recipient.name != "Steve Mandanda")

france_only_semi <- subset(france_only_semi, player.name != "Thomas Lemar")
france_only_semi <- subset(france_only_semi, pass.recipient.name != "Thomas Lemar")

france_only_semi <- subset(france_only_semi, player.name != "Steven N''Kemboanza Mike Christopher Nzonzi")
france_only_semi <- subset(france_only_semi, pass.recipient.name != "Steven N''Kemboanza Mike Christopher Nzonzi")

france_only_semi <- subset(france_only_semi, player.name != "Presnel Kimpembe")
france_only_semi <- subset(france_only_semi, pass.recipient.name != "Presnel Kimpembe")

france_only_semi <- subset(france_only_semi, player.name != "Ousmane Dembélé")
france_only_semi <- subset(france_only_semi, pass.recipient.name != "Ousmane Dembélé")

france_only_semi <- subset(france_only_semi, player.name != "Nabil Fekir")
france_only_semi <- subset(france_only_semi, pass.recipient.name != "Nabil Fekir")

france_only_semi <- subset(france_only_semi, player.name != "Florian Thauvin")
france_only_semi <- subset(france_only_semi, pass.recipient.name != "Florian Thauvin")

france_only_semi <- subset(france_only_semi, player.name != "Benjamin Mendy")
france_only_semi <- subset(france_only_semi, pass.recipient.name != "Benjamin Mendy")

# belgian team clean data
belgium_only_semi <- subset(team_name_france_belgium_semi, team.name == "Belgium")

belgium_only_semi <- subset(belgium_only_semi, player.name != "Thomas Vermaelen")
belgium_only_semi <- subset(belgium_only_semi, pass.recipient.name != "Thomas Vermaelen")

belgium_only_semi <- subset(belgium_only_semi, player.name != "Dries Mertens")
belgium_only_semi <- subset(belgium_only_semi, pass.recipient.name != "Dries Mertens")

belgium_only_semi <- subset(belgium_only_semi, player.name != "Thorgan Hazard")
belgium_only_semi <- subset(belgium_only_semi, pass.recipient.name != "Thorgan Hazard")

belgium_only_semi <- subset(belgium_only_semi, player.name != "Youri Tielemans")
belgium_only_semi <- subset(belgium_only_semi, pass.recipient.name != "Youri Tielemans")

belgium_only_semi <- subset(belgium_only_semi, player.name != "Adnan Januzaj")
belgium_only_semi <- subset(belgium_only_semi, pass.recipient.name != "Adnan Januzaj")

belgium_only_semi <- subset(belgium_only_semi, player.name != "Anga Dedryck Boyata")
belgium_only_semi <- subset(belgium_only_semi, pass.recipient.name != "Anga Dedryck Boyata")

belgium_only_semi <- subset(belgium_only_semi, player.name != "Leander Dendoncker")
belgium_only_semi <- subset(belgium_only_semi, pass.recipient.name != "Leander Dendoncker")


# construct dataset for connected passes only 
connected_pass_france_semi <- subset(france_only_semi, is.na(pass.outcome.name))
connected_pass_belgium_semi <- subset(belgium_only_semi, is.na(pass.outcome.name))

# create an edgelist of passes to and from players
france_semi <- cbind(connected_pass_france_semi$player.name, connected_pass_france_semi$pass.recipient.name)

belgium_semi <- cbind(connected_pass_belgium_semi$player.name, connected_pass_belgium_semi$pass.recipient.name)

# name these columns
colnames(france_semi) <- c("from", "to")
colnames(belgium_semi) <- c("from", "to")

# create a graph object for network analysis
france_semi.g <- graph.edgelist(france_semi, directed = TRUE) # makes a graph object
belgium_semi.g <- graph.edgelist(belgium_semi, directed = TRUE) # makes a graph object
```

#### Creating Network Objects

We then used the player name and pass recipient name columns of our datasets to create an edgelist and then a network object of connected passes to and from players on each team in both games. The below code is for the French team in the France-Croatia final:

```{r, warning = FALSE}
# create an edgelist of passes to and from players
france_final <- cbind(connected_pass_france_final$player.name, connected_pass_france_final$pass.recipient.name)

# name these columns
colnames(france_final) <- c("from", "to")

# create a graph object for network analysis
france_final.g <- graph.edgelist(france_final, directed = TRUE) # makes a graph object

```

#### Visualizing Directed Networks

To create accessible network visualizations, we used shape and color to distinguish between the positions played by player in each team across both games. The goalkeeper is a yellow sphere, the defenders are blue circles, the midfielders are purple squares, and the forwards are green rectangles. The below code assigns players on the French team to different positions: 

```{r identify-france-players, warning = FALSE}

france_midfielder <- c("Corentin Tolisso", "Paul Pogba", "N''Golo Kanté", "Blaise Matuidi", "Steven N''Kemboanza Mike Christopher Nzonzi", "Thomas Lemar", "Florian Thauvin")
france_defender <- c("Benjamin Pavard", "Samuel Yves Umtiti", "Raphaël Varane", "Lucas Hernández Pi", "Presnel Kimpembe", "Djibril Sidibé", "Benjamin Mendy")
france_forward <- c("Ousmane Dembélé", "Kylian Mbappé Lottin", "Antoine Griezmann", "Nabil Fekir", "Olivier Giroud")
france_goalkeeper <- c("Hugo Lloris")

V(france_final.g)[V(france_final.g)$name %in% france_midfielder]$color <- "#440154"
V(france_final.g)[V(france_final.g)$name %in% france_midfielder]$shape <- "square"
V(france_final.g)[V(france_final.g)$name %in% france_defender]$color <-"#31688e"
V(france_final.g)[V(france_final.g)$name %in% france_defender]$shape <- "circle"
V(france_final.g)[V(france_final.g)$name %in% france_forward]$color <- "#35b779"
V(france_final.g)[V(france_final.g)$name %in% france_forward]$shape <- "rectangle"
V(france_final.g)[V(france_final.g)$name %in% france_goalkeeper]$color <- "#fde725"
V(france_final.g)[V(france_final.g)$name %in% france_goalkeeper]$shape <- "sphere"
```

```{r identify-croatia-players, include = FALSE}

# player positions on team Croatia in the final
croatia_midfielder <- c("Luka Modrić", "Ivan Perišić", "Mateo Kovačić", "Marcelo Brozović","Ivan Rakitić", "Milan Badelj", "Filip Bradarić")
croatia_defender <- c("Domagoj Vida", "Dejan Lovren", "Šime Vrsaljko", "Duje Ćaleta-Car", "Ivan Strinić", "Josip Pivarić", "Tin Jedvaj", "Vedran Ćorluka")
croatia_forward <- c("Ante Rebić", "Andrej Kramarić", "Marko Pjaca", "Mario Mandžukić")
croatia_goalkeeper <- c("Danijel Subašić")
```

```{r belgium-players, include = FALSE}

# player positions on team Belgium in the semi-final
belgium_midfielder <- c("Kevin De Bruyne", "Axel Witsel", "Yannick Ferreira Carrasco", "Mousa Sidi Yaya Dembélé", "Thorgan Hazard", "Nacer Chadli", "Marouane Fellaini-Bakkioui", "Youri Tielemans", "Adnan Januzaj")
belgium_defender <- c("Thomas Meunier", "Anga Dedryck Boyata", "Jan Vertonghen", "Toby Alderweireld", "Leander Dendoncker", "Thomas Vermaelen", "Vincent Kompany")
belgium_forward <- c("Eden Hazard", "Dries Mertens", "Romelu Lukaku Menama", "Michy Batshuayi Tunga")
belgium_goalkeeper <- c("Thibaut Courtois")
```


```{r color-nodes, include = FALSE, warning = FALSE}

# Changing color and shape of croatia final nodes to represent a specific position

V(croatia_final.g)[V(croatia_final.g)$name %in% croatia_midfielder]$color <- "#440154"
V(croatia_final.g)[V(croatia_final.g)$name %in% croatia_midfielder]$shape <- "square"
V(croatia_final.g)[V(croatia_final.g)$name %in% croatia_defender]$color <-"#31688e"
V(croatia_final.g)[V(croatia_final.g)$name %in% croatia_defender]$shape <- "circle"
V(croatia_final.g)[V(croatia_final.g)$name %in% croatia_forward]$color <- "#35b779"
V(croatia_final.g)[V(croatia_final.g)$name %in% croatia_forward]$shape <- "rectangle"
V(croatia_final.g)[V(croatia_final.g)$name %in% croatia_goalkeeper]$color <- "#fde725"
V(croatia_final.g)[V(croatia_final.g)$name %in% croatia_goalkeeper]$shape <- "sphere"

# Changing color and shape of french semi nodes to represent a specific position

V(france_semi.g)[V(france_semi.g)$name %in% france_midfielder]$color <- "#440154"
V(france_semi.g)[V(france_semi.g)$name %in% france_defender]$color <- "#31688e"
V(france_semi.g)[V(france_semi.g)$name %in% france_forward]$color <- "#35b779"    
V(france_semi.g)[V(france_semi.g)$name %in% france_goalkeeper]$color <- "#fde725"
V(france_semi.g)[V(france_semi.g)$name %in% france_midfielder]$shape <- "square"
V(france_semi.g)[V(france_semi.g)$name %in% france_defender]$shape <-  "circle"
V(france_semi.g)[V(france_semi.g)$name %in% france_forward]$shape <- "rectangle"   
V(france_semi.g)[V(france_semi.g)$name %in% france_goalkeeper]$shape <- "sphere"

# Changing color and shape of belgium semi nodes to represent a specific position
V(belgium_semi.g)[V(belgium_semi.g)$name %in% belgium_midfielder]$color <- "#440154"
V(belgium_semi.g)[V(belgium_semi.g)$name %in% belgium_defender]$color <- "#31688e"
V(belgium_semi.g)[V(belgium_semi.g)$name %in% belgium_forward]$color <- "#35b779"    
V(belgium_semi.g)[V(belgium_semi.g)$name %in% belgium_goalkeeper]$color <- "#fde725"
V(belgium_semi.g)[V(belgium_semi.g)$name %in% belgium_midfielder]$shape <- "square"
V(belgium_semi.g)[V(belgium_semi.g)$name %in% belgium_defender]$shape <-  "circle"
V(belgium_semi.g)[V(belgium_semi.g)$name %in% belgium_forward]$shape <- "rectangle"   
V(belgium_semi.g)[V(belgium_semi.g)$name %in% belgium_goalkeeper]$shape <- "sphere"
```

To save the layouts for our network visualizations, we set a seed for each team in each game. Then, using a soccer field background and our network visualization, we scaled and offset the network to create a composite of both images. Below is the code for both France and Croatia in the France-Croatia final:

```{r, warning = FALSE, message = FALSE}
# French final team's network, choosing specific seed to get the same shape of the network every time
set.seed(11)
png(file="france_final.png", width=1000, height=1000)
par(bg="transparent")
plot(france_final.g, vertex.size = 20, vertex.label.cex = 1, vertex.label.color = "white")

# Croatian final team's network, choosing specific seed to get the same shape of the network every time
set.seed(10)
png(file="croatia_final.png", width=1000, height=1000)
par(bg="transparent")
plot(croatia_final.g, vertex.size = 20, vertex.label.cex = 1, vertex.label.color = "white")
dev.off()

soccer_png <- image_read("soccer_fil.png")
france_png_final <- image_read("france_final.png")
croatia_png_final <- image_read("croatia_final.png")

# so we dont have to re-read images from above
france_png_final <- france_png_final
croatia_png_final <- croatia_png_final
soccer_field <-soccer_png

# adding alt text to the image of the soccer field 
soccer_field_france_final <- image_annotate(soccer_field, "Figure 3: France's passing network in the 2018 World Cup Final against Croatia", size = 15, font = "Times",gravity = "west", color = "white", location = "+55+295")

soccer_field_croatia_final <- image_annotate(soccer_field, "Figure 4: Croatia's passing network in the 2018 World Cup Final against France", size = 15, font = "Times",gravity = "east", color = "white", location = "+55+295")

#scaling france network of passes image to 1000 height
france_png_final <- image_scale(france_png_final, "x1000")
croatia_png_final <- image_scale(croatia_png_final, "x1000")

#creating a composite of both images and moving the France network using offset to the right and down
# scaling the soccer field to 1000 in height 
final_france_image <- image_composite(image_scale(soccer_field_france_final, "x1000"), france_png_final, offset = "-500-50")
final_croatia_image <- image_composite(image_scale(soccer_field_croatia_final, "x1000"), croatia_png_final, offset = "+0")

```

```{r, include = FALSE, message = FALSE}
# Belgian team's network, choosing specific seed to get the same shape of the network every time
set.seed(2)
png(file="belgium_semi.png", width=1000, height=1000)
par(bg="transparent")
plot(belgium_semi.g, vertex.size = 20, vertex.label.cex = 1, vertex.label.color = "white")
dev.off()

# French team's network, choosing specific seed to get the same shape of the network every time
set.seed(1)
png(file="france_semi.png", width=1000, height=1000)
par(bg="transparent")
plot(france_semi.g, vertex.size = 20, vertex.label.cex = 1, vertex.label.color = "white")
dev.off()
```

```{r, include = FALSE}
#importing both a png image of a soccer field and the France and Belgium network of passes image created above
soccer_png <- image_read("soccer_fil.png")
france_semi_png <- image_read("france_semi.png")
belgium_semi_png <- image_read("belgium_semi.png")

# so we dont have to re-read images from above
france_pgn_semi <- france_semi_png
belgium_png_semi <- belgium_semi_png
soccer_field <- soccer_png

# adding alt text to the image of the soccer field 
soccer_field_france_semi <- image_annotate(soccer_field, "Figure 1: France's passing network in the 2018 World Cup semifinal against Belgium", size = 15, font = "Times",gravity = "west", color = "white", location = "+55+295")

soccer_field_belgium_semi <- image_annotate(soccer_field, "Figure 2: Belgium's passing network in the 2018 World Cup semifinal against France", size = 15, font = "Times",gravity = "east", color = "white", location = "+55+295")

#scaling France network of passes image to 1000 height
france_pgn_semi <- image_scale(france_pgn_semi, "x1000")
#creating a composite of both images and moving the France network using offset to the right and down
# scaling the soccer field to 1000 in height 
semi_france_image <- image_composite(image_scale(soccer_field_france_semi, "x1000"), france_pgn_semi, offset = "+500+0")


#scaling Belgium network of passes image to 1000 height
belgium_png_semi  <- image_scale(belgium_png_semi , "x1000")
#creating a composite of both images and moving the belgium network using offset to the right and down
# scaling the soccer field to 1000 in height 
semi_belgium_image <- image_composite(image_scale(soccer_field_belgium_semi, "x1000"), belgium_png_semi , offset = "+0+0")

```

##### France in the 2018 World Cup Semi-Final 

```{r plot-france-semi-field-network, warning = FALSE}
plot(semi_france_image)
```

##### Belgium in the 2018 World Cup Semi-Final 

```{r plot-belgium-semi-field-network, warning = FALSE}
plot(semi_belgium_image)
```

##### France in the 2018 World Cup Final 

```{r plot-france-final-field-network, warning = FALSE}
plot(final_france_image)
```

##### Croatia in the 2018 World Cup Final 

```{r plot-croatia-final-field-network, warning = FALSE}
plot(final_croatia_image)
```

 (include interpretation)


#### Centrality and Betweenness 

##### Centrality and Betweenness France Final

```{r, warning = FALSE}
# betweenness for france final
btwn.team <- betweenness(france_final.g)
names(btwn.team) <- V(france_final.g)$name
ind <- order(-btwn.team)
btwn.team[ind][1:14]
``` 

```{r, warning = FALSE}
# centrality for france final
cent.eig <- evcent(france_final.g)
names(cent.eig$vector) <- V(france_final.g)$name
ind <- order(-cent.eig$vector)
cent.eig$vector[ind][1:14]
```

```{r, warning = FALSE}
# betweenness for croatia final
btwn.team <- betweenness(croatia_final.g)
names(btwn.team) <- V(croatia_final.g)$name
ind <- order(-btwn.team)
btwn.team[ind][1:13]
``` 

```{r, warning = FALSE}
# centrality for croatia final
cent.eig <- evcent(croatia_final.g)
names(cent.eig$vector) <- V(croatia_final.g)$name
ind <- order(-cent.eig$vector)
cent.eig$vector[ind][1:13]
```

```{r, warning = FALSE}
# betweenness for france semi 
btwn.team <- betweenness(france_semi.g)
names(btwn.team) <- V(france_semi.g)$name
ind <- order(-btwn.team)
btwn.team[ind][1:13]
``` 

```{r, warning = FALSE}
# centrality for france semi 
cent.eig <- evcent(france_semi.g)
names(cent.eig$vector) <- V(france_semi.g)$name
ind <- order(-cent.eig$vector)
cent.eig$vector[ind][1:13]
```

```{r, warning = FALSE}
# betweenness for belgium semi
btwn.team <- betweenness(belgium_semi.g)
names(btwn.team) <- V(belgium_semi.g)$name
ind <- order(-btwn.team)
btwn.team[ind][1:14]
``` 

```{r, warning = FALSE}
# centrality for belgium semi
cent.eig <- evcent(belgium_semi.g)
names(cent.eig$vector) <- V(belgium_semi.g)$name
ind <- order(-cent.eig$vector)
cent.eig$vector[ind][1:14]
```

 (include interpretation using this article: (https://arxiv.org/pdf/1206.6904.pdf))

#### Modeling Sent and Received Passing Distributions for Teams in the 2018 World Cup Final and Semi-Final

To explore the distribution of sent and received passes on each team in both games, we first constructed frequency tables of the number of passes sent and received per player. The below code is for the French and Croatian team in the France-Croatia final:

```{r create-frequency-tables}
france_final_passes_from <- table(france_final[, 1])
france_final_passes_to <- table(france_final[, 2])

croatia_final_passes_from <- table(croatia_final[, 1])
croatia_final_passes_to <- table(croatia_final[, 2])
```

Then, we constructed bar plots, where the color of each bar corresponds to the player's position:

##### France in the 2018 World Cup Semi-Final 

```{r france-semi-sent-passes-code, include = FALSE, warning = FALSE}

#passes sent from each player data frame creation
from_table_france_semi <-table(france_semi[,1])
df_from_semi_france_sent <- as.data.frame(from_table_france_semi)

##having extra df unchanged df just in case for future use
extra_df_from_semi_france_sent<- df_from_semi_france_sent

#creating new column in our data frame
df_from_semi_france_sent$Position <- "a"
#for loop that inputs the position on of the player in the new position column
for(i in 1:nrow(df_from_semi_france_sent)){
  # our element we are working with
  df_row_check <- df_from_semi_france_sent$Var1[i]
  # checking if the player is a goalkeeper 
  if(df_row_check %in% france_goalkeeper){
    df_from_semi_france_sent$Position[i] <- "GK" # if a player is a goalkeeper it will input label in the position column of df
  }
  # checking if the player is a defender 
  if(df_row_check %in% france_defender){
    df_from_semi_france_sent$Position[i] <- "DF" # if a player is a defender it will input label in the position column of df
  }
   # checking if the player is a midfielder 
  if(df_row_check %in% france_midfielder){
    df_from_semi_france_sent$Position[i] <- "CM" # if a player is a midfielder it will input label in the position column of df
  }
   # checking if the player is a forward
  if(df_row_check %in% france_forward){
    df_from_semi_france_sent$Position[i] <- "FW" # if a player is a forward it will input label in the position column of df
  }
  
}

# making the positions a factor to categorize the different positions
df_from_semi_france_sent$Position <- as.factor(df_from_semi_france_sent$Position)
# Selecting specific colors to use for barplot 
mycolors <- c("#440154","#31688e","#35b779","#fde725")


# sorting the data frame to have player that completed the highest number of passes 
df_from_semi_france_sent_ordered <- df_from_semi_france_sent[order(-df_from_semi_france_sent$Freq),,]
par(mar=c(11,4,4,4)) # Increase margin size
# plotting barplot of the frequency a player completed a pass, colored based on the positon of the player
```

```{r france-semi-sent-passes-plot, warning = FALSE, fig.cap = "Figure 5: Barplot of passes sent on the French team in the 2018 World Cup semifinal where most midfielders and defenders send more passes than forwards and the goalkeeper."}
barplot(df_from_semi_france_sent_ordered$Freq,decreasing = TRUE, names.arg = df_from_semi_france_sent_ordered$Var1, decreasing = TRUE, ylab = "Number of Passes" ,col = mycolors[df_from_semi_france_sent_ordered$Position],las=2,cex.names = 0.5, legend.text= levels(df_from_semi_france_sent_ordered$Position), args.legend = list("topright", fill =mycolors ),  main = "Passes Sent in the 2018 World Cup Semi-Final (France)")

```

```{r france-semi-received-passes-code, include = FALSE, warning = FALSE}

#passes sent from each player data frame creation
to_table_france_semi <-table(france_semi[,2])
df_to_semi_france_received <- as.data.frame(to_table_france_semi)

##having extra df unchanged df just in case for future use
extra_df_to_semi_france_received <- df_to_semi_france_received 

#creating new column in our data frame
df_to_semi_france_received$Position <- "a"
#for loop that inputs the position on of the player in the new position column
for(i in 1:nrow(df_to_semi_france_received)){
  # our element we are working with
  df_row_check <- df_to_semi_france_received$Var1[i]
  # checking if the player is a goalkeeper 
  if(df_row_check %in% france_goalkeeper){
    df_to_semi_france_received$Position[i] <- "GK" # if a player is a goalkeeper it will input label in the position column of df
  }
  # checking if the player is a defender 
  if(df_row_check %in% france_defender){
    df_to_semi_france_received$Position[i] <- "DF" # if a player is a defender it will input label in the position column of df
  }
   # checking if the player is a midfielder 
  if(df_row_check %in% france_midfielder){
    df_to_semi_france_received$Position[i] <- "CM" # if a player is a midfielder it will input label in the position column of df
  }
   # checking if the player is a forward
  if(df_row_check %in% france_forward){
    df_to_semi_france_received$Position[i] <- "FW" # if a player is a forward it will input label in the position column of df
  }
  
}

# making the positions a factor to categorize the different positions
df_to_semi_france_received$Position <- as.factor(df_to_semi_france_received$Position)
# Selecting specific colors to use for barplot 
mycolors <- c("#440154","#31688e","#35b779","#fde725")


# sorting the data frame to have player that completed the highest number of passes 
df_to_semi_france_received_ordered <- df_to_semi_france_received[order(-df_to_semi_france_received$Freq),,]
par(mar=c(11,4,4,4)) # Increase margin size
```

```{r france-semi-received-passes-plot, warning = FALSE, fig.cap = "Figure 6: Barplot of passes receieved on the French team in the 2018 World Cup semifinal where no one or two positions receive the majority of the passes."}
# plotting barplot of the frequency a player completed a pass, colored based on the positon of the player
barplot(df_to_semi_france_received_ordered$Freq,decreasing = TRUE, names.arg = df_to_semi_france_received_ordered$Var1, decreasing = TRUE, ylab = "Number of Passes" ,col = mycolors[df_to_semi_france_received_ordered$Position],las=2,cex.names = 0.5, legend.text= levels(df_to_semi_france_received_ordered$Position), args.legend = list("topright", fill = mycolors ),  main = "Passes Received in the 2018 World Cup Semi-Final (France)")

```

We ran a power law fit test to determine if the distribution of sent and received passes on the French team in the French-Belgium semi-final was that of a power law distribution. We calculated an alpha value and p-value using the code below:

```{r power-law-fit-test-french-semi, warning = FALSE, message = FALSE}
# Creates Frequency Tables by Player for the French Team in the Semi
player_pass_france_s <- as.data.frame(table(connected_pass_france_semi$player.name))
player_recieve_france_s <- as.data.frame(table(connected_pass_france_semi$pass.recipient.name))
# Power Law Fit for the Passes by the French Team in the Semi
fit_power_law(player_pass_france_s$Freq)
# Power Law Fit for the Receptions by the French Team in the Semi
fit_power_law(player_recieve_france_s$Freq)
```

**Power Law Fit for the Passes and Receptions by the French Team in the Semifinal:** 

Using a frequency table for the number of passes and receptions made by the French team in the 2018 World Cup semifinal against Belgium, we were able to run a power law fit test to see if this data does in fact match a power law distribution. This analysis of the passes and receptions could be made separately, and each does tell its own story, but together the analyses make a better story. If we look at the alpha value for each, we see that alpha is 4.766 and 4.205 for the passes and receptions, respectively. A larger alpha implies that the data is heavily skewed, and a smaller alpha implies that the data is less skewed. So, we see that the passes and receptions made by each of the players on the French team are skewed at almost the same amount. If we look at the p-values, we see that the passes have a p-value of 0.924, which implies that it has a relatively high fit for the power law; the p-value for the receptions is 0.987, which also implies that the receptions by players have a higher fit for the power law. We can suggest that, in the semifinal, the French team was attempting to give the ball to their star players, which leads to a higher fit for the receptions. Anyone can steal and pass the ball, but which player you pass the ball to so that they can make an offensive play matters. If you give the ball to the star attackmen, then they have a good chance of scoring. This was a hard game for France, and they needed their star players to have the ball so they could score and thus win the game, which they did. 

##### Belgium in the 2018 World Cup Semi-Final 

```{r belgium-semi-sent-passes-code, include = FALSE, warning = FALSE}

#passes sent from each player data frame creation
from_table_bel <-table(belgium_semi[,1])
df_from_semi_bel <- as.data.frame(from_table_bel)

##having extra df unchanged df just in case for future use
extra_df_semi_bel<- df_from_semi_bel

#creating new column in our data frame
df_from_semi_bel$Position <- "a"
#for loop that inputs the position on of the player in the new position column
for(i in 1:nrow(df_from_semi_bel)){
  # our element we are working with
  df_row_check <- df_from_semi_bel$Var1[i]
  # checking if the player is a goalkeeper 
  if(df_row_check %in% belgium_goalkeeper){
    df_from_semi_bel$Position[i] <- "GK" # if a player is a goalkeeper it will input label in the position column of df
  }
  # checking if the player is a defender 
  if(df_row_check %in% belgium_defender){
    df_from_semi_bel$Position[i] <- "DF" # if a player is a defender it will input label in the position column of df
  }
   # checking if the player is a midfielder 
  if(df_row_check %in% belgium_midfielder){
    df_from_semi_bel$Position[i] <- "CM" # if a player is a midfielder it will input label in the position column of df
  }
   # checking if the player is a forward
  if(df_row_check %in% belgium_forward){
    df_from_semi_bel$Position[i] <- "FW" # if a player is a forward it will input label in the position column of df
  }
  
}

# making the positions a factor to categorize the different positions
df_from_semi_bel$Position <- as.factor(df_from_semi_bel$Position)
# Selecting specific colors to use for barplot 
mycolors <- c("#440154","#31688e","#35b779","#fde725")


# sorting the data frame to have player that completed the highest number of passes 
df_from_semi_bel_ordered <- df_from_semi_bel[order(-df_from_semi_bel$Freq),,]
par(mar=c(11,4,4,4)) # Increase margin size
```

```{r belgium-semi-sent-passes-plot, warning = FALSE, fig.cap = "Figure 7: Barplot of passes sent on the Belgian team in the 2018 World Cup semifinal where most midfielders and defenders send more passes than forwards and the goalkeeper."}
# plotting barplot of the frequency a player completed a pass, colored based on the positon of the player
barplot(df_from_semi_bel_ordered$Freq,decreasing = TRUE, names.arg = df_from_semi_bel_ordered$Var1, decreasing = TRUE, ylab = "Number of Passes" ,col = mycolors[df_from_semi_bel_ordered$Position],las=2,cex.names = 0.5, legend.text= levels(df_from_semi_bel_ordered$Position), args.legend = list("topright", fill =mycolors ),  main = "Passes Sent in the 2018 World Cup Semi-Final (Belgium)")

```

```{r belgium-semi-received-passes-code, include = FALSE, warning = FALSE}

#passes received from each player data frame creation
to_table_bel <-table(belgium_semi[,2])
df_to_semi_bel <- as.data.frame(to_table_bel)

##having extra df unchanged df just in case for future use
extra_df_semi_bel_to<- df_to_semi_bel

#creating new column in our data frame
df_to_semi_bel$Position <- "a"
#for loop that inputs the position on of the player in the new position column
for(i in 1:nrow(df_to_semi_bel)){
  # our element we are working with
  df_row_check <- df_to_semi_bel$Var1[i]
  # checking if the player is a goalkeeper 
  if(df_row_check %in% belgium_goalkeeper){
    df_to_semi_bel$Position[i] <- "GK" # if a player is a goalkeeper it will input label in the position column of df
  }
  # checking if the player is a defender 
  if(df_row_check %in% belgium_defender){
    df_to_semi_bel$Position[i] <- "DF" # if a player is a defender it will input label in the position column of df
  }
   # checking if the player is a midfielder 
  if(df_row_check %in% belgium_midfielder){
    df_to_semi_bel$Position[i] <- "CM" # if a player is a midfielder it will input label in the position column of df
  }
   # checking if the player is a forward
  if(df_row_check %in% belgium_forward){
    df_to_semi_bel$Position[i] <- "FW" # if a player is a forward it will input label in the position column of df
  }
  
}

# making the positions a factor to categorize the different positions
df_to_semi_bel$Position <- as.factor(df_to_semi_bel$Position)
# Selecting specific colors to use for barplot 
mycolors <- c("#440154","#31688e","#35b779","#fde725")


# sorting the data frame to have player that completed the highest number of passes 
df_to_semi_bel_ordered <- df_to_semi_bel[order(-df_to_semi_bel$Freq),,]
par(mar=c(11,4,4,4)) # Increase margin size
```

```{r belgium-semi-received-passes-plot, warning = FALSE, fig.cap = "Figure 8: Barplot of passes received on the Belgian team in the 2018 World Cup semifinal where most midfielders and defenders receive more passes than forwards and the goalkeeper."}
# plotting barplot of the frequency a player completed a pass, colored based on the positon of the player
barplot(df_to_semi_bel_ordered$Freq,decreasing = TRUE, names.arg = df_to_semi_bel_ordered$Var1, decreasing = TRUE, ylab = "Number of Passes" ,col = mycolors[df_to_semi_bel_ordered$Position],las=2,cex.names = 0.5, legend.text= levels(df_to_semi_bel_ordered$Position), args.legend = list("topright", fill =mycolors ),  main = "Passes Received in the 2018 World Cup Semi-Final (Belgium)")

```

Then, we ran a power law fit test to determine if the distribution of sent and received passes on the Belgian team in the French-Belgium semi-final was that of a power law distribution. We calculated an alpha value and p-value using the code below:

```{r power-law-fit-test-belgium-semi, warning = FALSE, message = FALSE}
# Creates Frequency Tables by Player for the Belgian Team in the Semi
player_pass_belgium_s <- as.data.frame(table(connected_pass_belgium_semi$player.name))
player_recieve_belgium_s <- as.data.frame(table(connected_pass_belgium_semi$pass.recipient.name))
# Power Law Fit for the Passes by the Belgian Team in the Final
fit_power_law(player_pass_belgium_s$Freq)
# Power Law Fit for the Receptions by the Belgian Team in the Final
fit_power_law(player_recieve_belgium_s$Freq)
```

**Power Law Fit for the Passes and Receptions by the Belgian Team in the Semifinal:** 

Using a frequency table for the number of passes and receptions made by the Belgian team in the 2018 World Cup semifinal against France, we were able to run a power law fit test to see if this data does in fact match a power law distribution. This analysis of the passes and receptions could be made separately, and each does tell its own story, but together the analyses make a better story. If we look at the alpha value for each, we see that alpha is 7.322 and 7.591 for the passes and receptions, respectively. A larger alpha implies that the data is heavily skewed, and a smaller alpha implies that the data is less skewed. So, we see that the passes and receptions made by each of the players on the Belgian team are skewed at almost the same amount, but this alpha is very high, so the data we collected is very skewed. If we look at the p-values, we see that the passes have a p-value of 0.999, which implies that it has a very high fit for the power law; the p-value for the receptions is also 0.999, which again implies that the receptions by players have a very high fit for the power law. We can suggest that, in the semifinal, the star players on the Belgian team had the vast majority of control of the ball. This would lead us to believe that the Belgian team is not as deep in terms of talent, and that they were giving it to their star players because this was a very tough game for them. The star players on the Belgian team needed to have the ball because they possessed the highest ability to score a goal against the veteran French team. Belgium did lose this game, but the score was 1-0, which suggests that both teams were playing very hard and had similar strategies.

```{r france-final-sent-passes-code, include = FALSE, warning = FALSE}

#passes sent from each player data frame creation
from_table_france_final <-table(france_final[,1])
df_from_final_france_sent <- as.data.frame(from_table_france_final)

##having extra df unchanged df just in case for future use
extra_df_from_final_france_sent <- df_from_final_france_sent

#creating new column in our data frame
df_from_final_france_sent$Position <- "a"
#for loop that inputs the position on of the player in the new position column
for(i in 1:nrow(df_from_final_france_sent)){
  # our element we are working with
  df_row_check <- df_from_final_france_sent$Var1[i]
  # checking if the player is a goalkeeper 
  if(df_row_check %in% france_goalkeeper){
    df_from_final_france_sent$Position[i] <- "GK" # if a player is a goalkeeper it will input label in the position column of df
  }
  # checking if the player is a defender 
  if(df_row_check %in% france_defender){
    df_from_final_france_sent$Position[i] <- "DF" # if a player is a defender it will input label in the position column of df
  }
   # checking if the player is a midfielder 
  if(df_row_check %in% france_midfielder){
    df_from_final_france_sent$Position[i] <- "CM" # if a player is a midfielder it will input label in the position column of df
  }
   # checking if the player is a forward
  if(df_row_check %in% france_forward){
    df_from_final_france_sent$Position[i] <- "FW" # if a player is a forward it will input label in the position column of df
  }
  
}

# making the positions a factor to categorize the different positions
df_from_final_france_sent$Position <- as.factor(df_from_final_france_sent$Position)
# Selecting specific colors to use for barplot 
mycolors <- c("#440154","#31688e","#35b779","#fde725")


# sorting the data frame to have player that completed the highest number of passes 
df_from_final_france_sent_ordered <- df_from_final_france_sent[order(-df_from_final_france_sent$Freq),,]
par(mar=c(11,4,4,4)) # Increase margin size
# plotting barplot of the frequency a player completed a pass, colored based on the positon of the player
```

##### France in the 2018 World Cup Final 

```{r france-final-sent-passes-plot, warning = FALSE, fig.cap = "Figure 9: Barplot of passes sent on the French team in the 2018 World Cup final where most midfielders and defenders send more passes than forwards and the goalkeeper."}
barplot(df_from_final_france_sent_ordered$Freq,decreasing = TRUE, names.arg = df_from_final_france_sent_ordered$Var1, decreasing = TRUE, ylab = "Number of Passes" ,col = mycolors[df_from_final_france_sent_ordered$Position],las=2,cex.names = 0.5, legend.text= levels(df_from_final_france_sent_ordered$Position), args.legend = list("topright", fill =mycolors ),  main = "Passes Sent in the 2018 World Cup Final (France)")

```

```{r france-final-received-passes-code, include = FALSE, warning = FALSE}

#passes sent from each player data frame creation
to_table_france_final <-table(france_final[,2])
df_to_final_france_received <- as.data.frame(to_table_france_final)

##having extra df unchanged df just in case for future use
extra_df_to_final_france_received <- df_to_final_france_received

#creating new column in our data frame
df_to_final_france_received$Position <- "a"
#for loop that inputs the position on of the player in the new position column
for(i in 1:nrow(df_to_final_france_received)){
  # our element we are working with
  df_row_check <- df_to_final_france_received$Var1[i]
  # checking if the player is a goalkeeper 
  if(df_row_check %in% france_goalkeeper){
    df_to_final_france_received$Position[i] <- "GK" # if a player is a goalkeeper it will input label in the position column of df
  }
  # checking if the player is a defender 
  if(df_row_check %in% france_defender){
    df_to_final_france_received$Position[i] <- "DF" # if a player is a defender it will input label in the position column of df
  }
   # checking if the player is a midfielder 
  if(df_row_check %in% france_midfielder){
    df_to_final_france_received$Position[i] <- "CM" # if a player is a midfielder it will input label in the position column of df
  }
   # checking if the player is a forward
  if(df_row_check %in% france_forward){
    df_to_final_france_received$Position[i] <- "FW" # if a player is a forward it will input label in the position column of df
  }
  
}

# making the positions a factor to categorize the different positions
df_to_final_france_received$Position <- as.factor(df_to_final_france_received$Position)
# Selecting specific colors to use for barplot 
mycolors <- c("#440154","#31688e","#35b779","#fde725")


# sorting the data frame to have player that completed the highest number of passes 
df_to_final_france_received_ordered <- df_to_final_france_received[order(-df_to_final_france_received$Freq),,]
par(mar=c(11,4,4,4)) # Increase margin size
```

```{r france-final-received-passes-plot, warning = FALSE, fig.cap = "Figure 10: Barplot of passes received on the French team in the 2018 World Cup final where no one or two positions receive the majority of the passes."}
# plotting barplot of the frequency a player completed a pass, colored based on the positon of the player
barplot(df_to_final_france_received_ordered$Freq,decreasing = TRUE, names.arg = df_to_final_france_received_ordered$Var1, decreasing = TRUE, ylab = "Number of Passes" ,col = mycolors[df_to_final_france_received_ordered$Position],las=2,cex.names = 0.5, legend.text= levels(df_to_final_france_received_ordered$Position), args.legend = list("topright", fill = mycolors ),  main = "Passes Received in the 2018 World Cup Final (France)")

```

Again, we ran a power law fit test to determine if the distribution of sent and received passes on the French team in the Croatia-French final was that of a power law distribution. We calculated an alpha value and p-value using the code below:

```{r power-law-fit-test-french-final, warning = FALSE, message = FALSE}
# Creates Frequency Tables by Player for the French Team in the Final
player_pass_france_f <- as.data.frame(table(connected_pass_france_final$player.name))
player_recieve_france_f <- as.data.frame(table(connected_pass_france_final$pass.recipient.name))
# Power Law Fit for the Passes by the French Team in the Final
fit_power_law(player_pass_france_f$Freq)
# Power Law Fit for the Receptions by the French Team in the Final
fit_power_law(player_recieve_france_f$Freq)
```

**Power Law Fit for the Passes and Receptions by the French Team in the Final:** 

Using a frequency table for the number of passes and receptions made by the French team in the 2018 World Cup final, we were able to run a power law fit test to see if this data does in fact match a power law distribution. This analysis of the passes and receptions could be made separately, and each does tell its own story, but together the analyses make a better story. If we look at the alpha value for each, we see that alpha is 5.114 and 3.287 for the passes and receptions, respectively. A larger alpha implies that the data is heavily skewed, and a smaller alpha implies that the data is less skewed. So, we see that the passes made by each of the players on the French team are less skewed and the receptions are more skewed. If we look at the p-values, we see that the passes have a p-value of 0.950, which implies that it has a relatively high fit for the power law; the p-value for the receptions is 0.942, which also implies that the receptions by players have a relatively high fit for the power law. We can suggest that, in the final, the French team was attempting to spread out their passes a little bit because the Croatian players were heavily defending their star players, which lead to a lower fit for the receptions. It also seems like the passes would be made by those in the midfield who were “running” whatever “play” the French team was trying to execute so that they could score a goal, which suggests that the French team was very organized, which makes sense because they were the veteran team. So, the passers have a higher fit for the power law, but the receivers do not have as high of a fit because they are trying to evade the Croatian defenders guarding their star players who would be the ones that could potentially score the most goals.


##### Croatia in the 2018 World Cup Final 

```{r croatia-final-sent-passes-code, include = FALSE, warning = FALSE}

#passes sent from each player data frame creation
from_table_croatia <- table(croatia_final[,1])
df_from_final_croatia_sent <- as.data.frame(from_table_croatia)

##having extra df unchanged df just in case for future use
extra_df_from_final_croatia_sent <- df_from_final_croatia_sent

#creating new column in our data frame
df_from_final_croatia_sent$Position <- "a"
#for loop that inputs the position on of the player in the new position column
for(i in 1:nrow(df_from_final_croatia_sent)){
  # our element we are working with
  df_row_check <- df_from_final_croatia_sent$Var1[i]
  # checking if the player is a goalkeeper 
  if(df_row_check %in% croatia_goalkeeper){
    df_from_final_croatia_sent$Position[i] <- "GK" # if a player is a goalkeeper it will input label in the position column of df
  }
  # checking if the player is a defender 
  if(df_row_check %in% croatia_defender){
    df_from_final_croatia_sent$Position[i] <- "DF" # if a player is a defender it will input label in the position column of df
  }
   # checking if the player is a midfielder 
  if(df_row_check %in% croatia_midfielder){
    df_from_final_croatia_sent$Position[i] <- "CM" # if a player is a midfielder it will input label in the position column of df
  }
   # checking if the player is a forward
  if(df_row_check %in% croatia_forward){
    df_from_final_croatia_sent$Position[i] <- "FW" # if a player is a forward it will input label in the position column of df
  }
  
}

# making the positions a factor to categorize the different positions
df_from_final_croatia_sent$Position <- as.factor(df_from_final_croatia_sent$Position)
# Selecting specific colors to use for barplot 
mycolors <- c("#440154","#31688e","#35b779","#fde725")


# sorting the data frame to have player that completed the highest number of passes 
df_from_final_croatia_sent_ordered <- df_from_final_croatia_sent[order(-df_from_final_croatia_sent$Freq),,]
par(mar=c(11,4,4,4)) # Increase margin size
```

```{r croatia-final-sent-passes-plot, warning = FALSE, fig.cap = "Figure 11: Barplot of passes sent on the Croatian team in the 2018 World Cup final where all midfielders and defenders send more passes than forwards and the goalkeeper."}
# plotting barplot of the frequency a player completed a pass, colored based on the positon of the player
barplot(df_from_final_croatia_sent_ordered$Freq,decreasing = TRUE, names.arg = df_from_final_croatia_sent_ordered$Var1, decreasing = TRUE, ylab = "Number of Passes" ,col = mycolors[df_from_final_croatia_sent_ordered$Position],las=2,cex.names = 0.5, legend.text= levels(df_from_final_croatia_sent_ordered$Position), args.legend = list("topright", fill =mycolors ),  main = "Passes Sent in the 2018 World Cup Final (Croatia)")

```

```{r croatia-final-received-passes-code, include = FALSE, warning = FALSE}

#passes received from each player data frame creation
to_table_croatia <-table(croatia_final[,2])
df_to_final_croatia_receieved <- as.data.frame(to_table_croatia)

##having extra df unchanged df just in case for future use
extra_df_to_final_croatia_receieved<- df_to_final_croatia_receieved

#creating new column in our data frame
df_to_final_croatia_receieved$Position <- "a"
#for loop that inputs the position on of the player in the new position column
for(i in 1:nrow(df_to_final_croatia_receieved)){
  # our element we are working with
  df_row_check <- df_to_final_croatia_receieved$Var1[i]
  # checking if the player is a goalkeeper 
  if(df_row_check %in% croatia_goalkeeper){
    df_to_final_croatia_receieved$Position[i] <- "GK" # if a player is a goalkeeper it will input label in the position column of df
  }
  # checking if the player is a defender 
  if(df_row_check %in% croatia_defender){
    df_to_final_croatia_receieved$Position[i] <- "DF" # if a player is a defender it will input label in the position column of df
  }
   # checking if the player is a midfielder 
  if(df_row_check %in% croatia_midfielder){
    df_to_final_croatia_receieved$Position[i] <- "CM" # if a player is a midfielder it will input label in the position column of df
  }
   # checking if the player is a forward
  if(df_row_check %in% croatia_forward){
    df_to_final_croatia_receieved$Position[i] <- "FW" # if a player is a forward it will input label in the position column of df
  }
  
}

# making the positions a factor to categorize the different positions
df_to_final_croatia_receieved$Position <- as.factor(df_to_final_croatia_receieved$Position)
# Selecting specific colors to use for barplot 
mycolors <- c("#440154","#31688e","#35b779","#fde725")


# sorting the data frame to have player that completed the highest number of passes 
df_to_final_croatia_receieved_ordered <- df_to_final_croatia_receieved[order(-df_to_final_croatia_receieved$Freq),,]
par(mar=c(11,4,4,4)) # Increase margin size
```

```{r croatia-final-received-passes-plot, warning = FALSE, fig.cap = "Figure 12: Barplot of passes received on the Croatian team in the 2018 World Cup final where all midfielders and defenders receive more passes than forwards and the goalkeeper."}
# plotting barplot of the frequency a player completed a pass, colored based on the positon of the player
barplot(df_to_final_croatia_receieved_ordered$Freq,decreasing = TRUE, names.arg = df_to_final_croatia_receieved_ordered$Var1, decreasing = TRUE, ylab = "Number of Passes" ,col = mycolors[df_to_final_croatia_receieved_ordered$Position],las=2,cex.names = 0.5, legend.text= levels(df_to_final_croatia_receieved_ordered$Position), args.legend = list("topright", fill =mycolors ),  main = "Passes Received in the 2018 World Cup Final (Croatia)")

```

Lastly, we ran a power law fit test to determine if the distribution of sent and received passes on the Croatian team in the Croatia-French final was that of a power law distribution. We calculated an alpha value and p-value using the code below:

```{r power-law-fit-test-croatia-final, warning = FALSE, message = FALSE}
# Creates Frequency Tables by Player for the Croatian Team in the Final
player_pass_croatia_f <- as.data.frame(table(connected_pass_croatia_final$player.name))
player_recieve_croatia_f <- as.data.frame(table(connected_pass_croatia_final$pass.recipient.name))
# Power Law Fit for the Passes by the Croatian Team in the Final
fit_power_law(player_pass_croatia_f$Freq)
# Power Law Fit for the Receptions by the Croatian Team in the Final
fit_power_law(player_recieve_croatia_f$Freq)
```

**Power Law Fit for the Passes and Receptions by the Croatian Team in the Final:** 

Using a similar frequency table, like the one used above, for the number of passes and receptions made by the Croatian team in the 2018 World Cup final, we were able to run a power-law fit test to see if this data does in fact match a power law distribution. This analysis of the passes and receptions could be made separately, and each does tell its own story, but together the analyses make a better story. If we look at the alpha value for each, we see that alpha is 1.883 and 6.342 for the passes and receptions, respectively. A larger alpha implies that the data is heavily skewed, and a smaller alpha implies that the data is less skewed. We see that the number of passes made by each of the Croatian players is less skewed, but the receptions are very skewed. If we look at the p-values, we see that the passes have a p-value of 0.546, which implies that it has a relatively low fit for the power law. The number of passes is more evenly distributed because anyone can steal the ball, and thus make a pass. Conversely, we see that the p-value for the receptions is 0.989, which says that all of the receptions made do fit the power law very well. This makes sense because when looking to advance up the field, you want to pass it to your best players so that they may score a goal, which makes sense because France was in control of this game from the start. So, a few players receive the majority of the passes, whereas the rest of the players only receive the ball a few times because you want your best players to have control of the ball so that you can score goals and win the game. In the context of the game, we believe that the reason we came to these conclusions is that the defenders are stealing the ball and making passes, but they are passing to the offensive players so that they can counterattack and score. One of the most effective ways to score a goal in soccer is to quickly get control of the ball while the other team is attacking and make a lightning-quick drive for the goal because the other team is focused on their own attack. Counterattacks are effective plays and lead to a good shot for a team to score a goal, which Croatia needed in this game because France was leading from the start.
 
#### Limitations and Future Work

While these passing network analyses offer insights into playing strategy and key players, there are multiple ways that these analyses may be refined or extended in the future. By standardizing by playing time, our analyses of pass distributions across teams in different 2018 World Cup games would more accurately reflect team dynamics and key player positions in sending and receiving passes on different teams. Further, by utilizing the starting and ending coordinates of passes from the [Dato-Futbol/passing-networks GitHub repository](https://github.com/Dato-Futbol/passing-networks), our passing network visualizations could be extended to create a network of player positions and accurate mappings of passes between them based on real-time coordinates data. It would even be possible to construct a heatmap of where passes occur across the field. 


5. References to at least four pieces of scholarly writing (these should include readings from the disciplinary or domain space that your question is in, as well as network theory readings from the course)

1. Football passing networks using R (https://www.datofutbol.cl/passing-networks-r/)
2. Using Network Science to Analyse Football Passing Networks: Dynamics, Space, Time, and the Multilayer Nature of the Game (https://www.frontiersin.org/articles/10.3389/fpsyg.2018.01900/full)
3. A network theory analysis of football strategies (https://arxiv.org/pdf/1206.6904.pdf)
4. Play-by-Play Network Analysis in Football (https://www.ncbi.nlm.nih.gov/pmc/articles/PMC6669815/)
5. Player position relationships with centrality in the passing network of world cup soccer teams: Win/loss match comparisons (https://reader.elsevier.com/reader/sd/pii/S0960077920300242?token=8E57B44BFF232C5A65695EB10963EC50F09AA44F926BA77E421EA97D4C50493E29D978F1D360149CC7A674D5CF2994E8&originRegion=us-east-1&originCreation=20220405191913)
6. Nepusz, T., &amp; Csardi, G. (n.d.). Fit_power_law: Fitting a power-law distribution function to discrete data. RDocumentation. Retrieved April 19, 2022, from (https://www.rdocumentation.org/packages/igraph/versions/1.3.0/topics/fit_power_law)  









