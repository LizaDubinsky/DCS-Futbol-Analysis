---
title: "Final Project DCS 375"
author: "Dieter Villegas, Liza Dubinsky, Quinn Macauley"
date: "4/6/2022"
output: html_document
---


```{r load-libraries}
library(dplyr)
library(igraph)
library(bipartite)
```


```{r clean-data}

# read in the RDS
wc_rds <- readRDS("WC_events_clean.RDS")

# grab only the columns we're interested in for analysis
wc_maxtrix <- cbind(wc_rds$period,wc_rds$timestamp, wc_rds$duration,wc_rds$possession_team.name,wc_rds$type.name,wc_rds$player.name,wc_rds$team.name,wc_rds$pass.length,wc_rds$pass.recipient.name,wc_rds$pass.outcome.name,wc_rds$ball_receipt.outcome.name,wc_rds$match_id,wc_rds$location.x,wc_rds$location.y,wc_rds$pass.end_location.x,wc_rds$pass.end_location.y)

# turn into a dataframe
wc_df_official <- as.data.frame(wc_maxtrix)

# rename the columns for analysis
colnames(wc_df_official) <- c("period","timestamp","duration","possession_team.name","type.name","player.name","team.name","pass.length","pass.recipient.name","pass.outcome.name","ball_receipt.outcome.name","match_id","location.x","location.y","pass.end_location.x","pass.end_location.y")

# grab only the passes
network_passes <- subset(wc_df_official, type.name == "Pass")

# create 4 data sets for four games we plan to analyze
france_croatia_final <- subset(network_passes, possession_team.name == c("France", "Croatia"))

france_belgium_semi <- subset(network_passes, team.name == c("France", "Belgium"))

france_uruguay_quarter <- subset(network_passes, team.name == c("France", "Uruguay"))

france_argentina_round <- subset(network_passes, team.name == c("France", "Argentina"))

# write 4 csv files for each of these games

write.csv(france_croatia_final, "france_croatia_final.csv", row.names = FALSE)

write.csv(france_belgium_semi, "france_belgium_semi.csv", row.names = FALSE)

write.csv(france_uruguay_quarter, "france_uruguay_quarter.csv", row.names = FALSE)

write.csv(france_argentina_round, "france_argentina_round.csv", row.names = FALSE)

```

```{r}
# clean the data frame to only include passes from france and croatia final
team_name_france_croatia_final <- subset(france_croatia_final, team.name == c("France", "Croatia"))

france_only_final <- subset(team_name_france_croatia_final, team.name == "France")

croatia_only_final <- subset(team_name_france_croatia_final, team.name == "Croatia")

# construct dataset for connected passes only 
connected_pass_france_final <- subset(france_only_final, is.na(pass.outcome.name))
connected_pass_croatia_final <- subset(croatia_only_final, is.na(pass.outcome.name))

# create an edgelist of passes to and from players
france_final <- cbind(connected_pass_france_final$player.name, connected_pass_france_final$pass.recipient.name)

croatia_final <- cbind(connected_pass_croatia_final$player.name, connected_pass_croatia_final$pass.recipient.name)

# name these columns
colnames(france_final) <- c("from", "to")
colnames(croatia_final) <- c("from", "to")
```

```{r france-final-object}


# create a graph object for network analysis
france_final.g <- graph.edgelist(france_final.a, directed = TRUE) # makes a graph object
croatia_final.g <- graph.edgelist(croatia_final, directed = TRUE) # makes a graph object

png(file="france_final.png", width=4000, height=4000)
plot(france_final.g, edge.width = E(france_final.g)$weight)
png(file="croatia_final.png", width=4000, height=4000)
plot(croatia_final.g)
dev.off()
```

```{r}
connected_pass_france_final %>%
  filter(team.name != possession_team.name)
```
